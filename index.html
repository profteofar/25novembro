<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sequ√™ncia Did√°tica: 25 de Novembro de 1975</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fontes -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700;900&family=Roboto+Slab:wght@400;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    
    <!-- Babel para JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              'serif': ['Merriweather', 'serif'],
              'slab': ['Roboto Slab', 'serif'],
              'sans': ['Inter', 'sans-serif'],
            },
            colors: {
              'rev-red': '#b91c1c',      /* Vermelho escuro revolucion√°rio */
              'rev-dark': '#1c1917',     /* Stone 900 */
              'rev-stone': '#e7e5e4',    /* Stone 200 */
              'rev-paper': '#f5f5f4',    /* Stone 100 */
              'rev-gold': '#d97706',     /* Amber 600 */
              'military': '#3f6212',     /* Verde Tropa */
            }
          }
        }
      }
    </script>
    <style>
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.3s ease-out forwards;
        }

        /* Efeito de Flip Card */
        .perspective-1000 { perspective: 1000px; }
        .transform-style-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
        
        /* Estilos de Impress√£o Otimizados */
        @media print {
            body * { visibility: hidden; }
            #printable-area, #printable-area * { visibility: visible; }
            #printable-area {
                position: absolute; 
                left: 0; 
                top: 0; 
                width: 100%; 
                background-color: white !important; 
                color: black !important; 
                border: none !important;
            }
            .page-break { page-break-before: always; }
            .no-print { display: none !important; }
            /* Reset cores para impress√£o */
            .bg-rev-paper { background-color: #f5f5f4 !important; -webkit-print-color-adjust: exact; }
            .text-rev-red { color: #b91c1c !important; }
            .text-rev-gold { color: #d97706 !important; }
        }
    </style>
    
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.263.1"
      }
    }
    </script>
</head>
<body class="bg-rev-dark text-rev-stone font-sans selection:bg-rev-red selection:text-white overflow-x-hidden">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useCallback, StrictMode } from 'react';
        import ReactDOM from 'react-dom/client';
        import { BookOpen, Clock, Users, HelpCircle, ChevronRight, ChevronLeft, Menu, X, CheckCircle, AlertCircle, Play, Award, Scale, Scroll, Shield, Gavel, Maximize2, Headphones, Video, Projector, Image as ImageIcon, RotateCcw, Eye, List, Copy, Repeat, Link as LinkIcon, MessageSquare, FileText, GraduationCap, Gamepad2 } from 'lucide-react';

        // --- DADOS DO CONTE√öDO ---

        const APP_SECTIONS = {
          INTRO: 'intro',
          LEARNING: 'learning',
          TIMELINE: 'timeline',
          FLASHCARDS: 'flashcards',
          FORMATIVE: 'formative',
          DEBATE: 'debate',
          QUIZ: 'quiz',
          CONCLUSION: 'conclusion',
        };

        const LEARNING_CONTENT = [
          {
            title: "O Contexto Explosivo: O PREC",
            icon: <AlertCircle size={64} className="text-rev-red" />,
            paragraphs: [
              "O Processo Revolucion√°rio em Curso (PREC) foi o per√≠odo de extrema instabilidade entre 1974 e 1975. Portugal vivia um clima de 'pr√©-guerra civil', marcado por greves, ocupa√ß√µes de terras e f√°bricas, e nacionaliza√ß√µes.",
              "O Estado estava paralisado por uma estrutura de 'duplo poder': a legitimidade eleitoral da Assembleia Constituinte colidia com a legitimidade revolucion√°ria dos militares do MFA.",
              "O pa√≠s era descrito internacionalmente como um 'manic√≥mio em autogest√£o', com receios nos EUA (Kissinger) de que Portugal se tornasse uma 'Cuba na Europa'."
            ]
          },
          {
            title: "O Ver√£o Quente de 1975",
            icon: <Play size={64} className="text-orange-500" />,
            paragraphs: [
              "A polariza√ß√£o atingiu o auge no ver√£o de 1975. O pa√≠s dividiu-se geograficamente e ideologicamente: o Norte conservador e anti-comunista vs. o Sul onde a reforma agr√°ria avan√ßava.",
              "A viol√™ncia escalou com assaltos a sedes de partidos de esquerda no Norte e atentados bombistas de grupos como o MDLP.",
              "O 'Cerco √† Assembleia Constituinte' e o assalto √† Embaixada de Espanha foram sinais claros da perda de autoridade do Estado."
            ]
          },
          {
            title: "Tr√™s Projetos em Confronto",
            icon: <Users size={64} className="text-rev-gold" />,
            paragraphs: [
              "1. Moderados (Grupo dos Nove): Liderados por Melo Antunes e operacionalmente por Ramalho Eanes. Defendiam uma democracia pluralista tipo ocidental, o primado da lei e a subordina√ß√£o militar ao poder civil.",
              "2. Esquerda Militar (COPCON): Liderada por Otelo Saraiva de Carvalho. Defendia o 'Poder Popular', uma democracia direta de base (comiss√µes de moradores/soldados) e rejeitava a democracia parlamentar 'burguesa'.",
              "3. PCP / Gon√ßalvistas: Setor pr√≥ximo de Vasco Gon√ßalves. Defendia uma 'Vanguarda Revolucion√°ria' e o controlo do aparelho de Estado para avan√ßar para o socialismo, mas optou por um 'recuo t√°tico' no dia 25."
            ]
          },
          {
            title: "O Desencadeador e a Resposta",
            icon: <Shield size={64} className="text-blue-400" />,
            paragraphs: [
              "A causa imediata foi a substitui√ß√£o de Otelo pelo moderado Vasco Louren√ßo no comando da Regi√£o Militar de Lisboa. Em resposta, paraquedistas ocuparam a base de Tancos, ativando a crise.",
              "O Presidente Costa Gomes foi a figura crucial: ao decretar o Estado de S√≠tio, legalizou a a√ß√£o dos Moderados e desmobilizou o apoio civil aos radicais.",
              "Ramalho Eanes executou um plano militar profissional a partir da Amadora, neutralizando os pontos chave sem banho de sangue significativo."
            ]
          },
          {
            title: "Consequ√™ncias e Legado",
            icon: <Award size={64} className="text-green-500" />,
            paragraphs: [
              "O 25 de Novembro encerrou o PREC e a tutela militar sobre a pol√≠tica. O MFA foi extinto enquanto motor pol√≠tico e o ex√©rcito regressou aos quart√©is.",
              "Este evento garantiu a estabilidade necess√°ria para aprovar a Constitui√ß√£o de 1976 e realizar as primeiras elei√ß√µes livres e universais.",
              "Historicamente, representa o triunfo da democracia representativa sobre as utopias revolucion√°rias de extrema-esquerda e as tentativas de restaura√ß√£o autorit√°ria de direita."
            ]
          },
          {
            title: "Apresenta√ß√£o: Resumo Visual",
            icon: <Projector size={64} className="text-purple-400" />,
            paragraphs: [
              "Navegue pela apresenta√ß√£o de diapositivos abaixo para consolidar a mat√©ria.",
              "Utilize as setas para alternar entre os slides e clique na imagem para ampliar."
            ],
            slides: Array.from({length: 15}, (_, i) => `./slides${i+1}.jpg`)
          },
          {
            title: "Infografia: A Din√¢mica da Crise",
            icon: <Scroll size={64} className="text-green-400" />,
            paragraphs: [
              "Analise a infografia seguinte para compreender as movimenta√ß√µes militares no terreno.",
              "Clique na imagem abaixo para ampliar e explorar os detalhes."
            ],
            image: "./infografia.jpg",
            imageAlt: "Infografia detalhada sobre o 25 de Novembro"
          },
          {
            title: "Recursos Audiovisuais",
            icon: <Play size={64} className="text-rev-red" />,
            paragraphs: [
              "Aprofunde o seu conhecimento com estes registos hist√≥ricos.",
              "Veja o v√≠deo documental e oi√ßa o podcast para uma an√°lise aprofundada dos eventos."
            ],
            video: "./crisenovembro1975.mp4",
            audio: "./crisenovembro1975.mp3"
          }
        ];

        const TIMELINE_EVENTS = [
          { period: "25 ABR 1975", title: "Elei√ß√µes Constituinte", desc: "Primeiras elei√ß√µes livres. Vit√≥ria do PS, mas o poder real continuava no MFA." },
          { period: "VER√ÉO 1975", title: "Ver√£o Quente", desc: "Viol√™ncia pol√≠tica, assaltos a sedes, divis√µes profundas Norte/Sul." },
          { period: "AGO 1975", title: "Documento dos Nove", desc: "Melo Antunes publica manifesto contra a 'ditadura' revolucion√°ria, unindo os moderados." },
          { period: "12 NOV 1975", title: "Cerco ao Parlamento", desc: "Oper√°rios da constru√ß√£o civil cercam deputados. O governo suspende fun√ß√µes a 20 Nov." },
          { period: "25 NOV (Manh√£)", title: "Insurrei√ß√£o", desc: "Paraquedistas ocupam bases a√©reas (Tancos, Monte Real) em protesto contra a sa√≠da de Otelo." },
          { period: "25 NOV (16:30)", title: "Ponto de Viragem", desc: "Costa Gomes decreta Estado de S√≠tio. Eanes assume o comando das opera√ß√µes." },
          { period: "26 NOV", title: "Vit√≥ria Moderada", desc: "Comandos da Amadora (Jaime Neves) controlam Lisboa. Rendi√ß√£o do COPCON." },
          { period: "2 ABR 1976", title: "Constitui√ß√£o", desc: "Aprova√ß√£o da Constitui√ß√£o da Rep√∫blica, consagrando o estado de direito democr√°tico." }
        ];

        // --- DADOS FLASHCARDS (15 Cart√µes) ---
        const FLASHCARD_DATA = [
            { q: "No contexto da Guerra Fria, qual era o principal receio de Henry Kissinger (EUA) em rela√ß√£o a Portugal?", a: "O receio era o surgimento de uma 'nova Cuba' na Europa, levando os EUA a considerar uma invas√£o." },
            { q: "Qual era a tese principal do livro 'Portugal e o Futuro' de Ant√≥nio de Sp√≠nola (1974)?", a: "Advogava uma solu√ß√£o pol√≠tica, e n√£o militar, como sa√≠da para a Guerra do Ultramar." },
            { q: "Quais eram os tr√™s objetivos fundamentais do MFA, conhecidos como os tr√™s 'D'?", a: "Descolonizar, Desenvolver e Democratizar." },
            { q: "O que foi o 'Levantamento das Caldas' a 16 de mar√ßo de 1974?", a: "Uma tentativa falhada de golpe que mostrou ao MFA que a via militar era a √∫nica op√ß√£o para derrubar a ditadura." },
            { q: "Quem foi o primeiro Presidente da Rep√∫blica eleito por sufr√°gio universal ap√≥s a revolu√ß√£o (1976)?", a: "O General Ramalho Eanes." },
            { q: "Que fa√ß√£o do MFA defendia uma transi√ß√£o gradual para uma democracia pluralista de tipo ocidental?", a: "O setor moderado, conhecido como o 'Grupo dos Nove', liderado por Melo Antunes." },
            { q: "Qual foi o papel de Otelo Saraiva de Carvalho no 25 de Abril de 1974?", a: "Foi o principal estratega e comandante das opera√ß√µes militares." },
            { q: "O que representou a cria√ß√£o do Conselho da Revolu√ß√£o ap√≥s o 11 de Mar√ßo de 1975?", a: "A institucionaliza√ß√£o do poder militar como √≥rg√£o pol√≠tico supremo." },
            { q: "A tentativa de golpe de 11 de Mar√ßo de 1975, liderada por Sp√≠nola, visava travar que setor?", a: "Visava travar a esquerda revolucion√°ria e a sua crescente influ√™ncia." },
            { q: "Qual era a fun√ß√£o da PIDE durante o Estado Novo?", a: "Pol√≠cia pol√≠tica respons√°vel pela repress√£o da oposi√ß√£o e controlo social." },
            { q: "Qual foi a motiva√ß√£o inicial do 'Movimento dos Capit√£es'?", a: "A oposi√ß√£o ao regime e √† guerra colonial, procurando salvar a 'dignidade' militar." },
            { q: "De que forma a popula√ß√£o civil alterou a din√¢mica do golpe de 25 de Abril?", a: "A popula√ß√£o saiu √†s ruas, confraternizou com os soldados e exigiu a liberta√ß√£o dos presos pol√≠ticos." },
            { q: "Em que territ√≥rios africanos as for√ßas armadas enfrentavam guerrilhas?", a: "Guin√©-Bissau, Angola e Mo√ßambique." },
            { q: "Que nome informal foi dado ao plano operacional de Ramalho Eanes no 25 de Novembro?", a: "O 'Plano dos Coron√©is'." },
            { q: "Qual foi o papel do Brigadeiro Pires Veloso durante a crise de 1975?", a: "Conhecido como 'Vice-rei do Norte', comandou a Regi√£o Militar Norte, um basti√£o anti-radical." }
        ];

        // --- DADOS ATIVIDADES PR√ÅTICAS ---
        const MATCHING_CHALLENGES = [
            { id: 'lideres', title: "L√≠deres e Fa√ß√µes", items: [{ id: 'eanes', label: "Ramalho Eanes", match: "Moderados" }, { id: 'otelo', label: "Otelo Saraiva de Carvalho", match: "COPCON / Radicais" }, { id: 'vasco', label: "Vasco Gon√ßalves", match: "Gon√ßalvistas" }, { id: 'jaime', label: "Jaime Neves", match: "Comandos" }] },
            { id: 'datas', title: "Datas Importantes", items: [{ id: '25abr', label: "25 de Abril 1974", match: "Revolu√ß√£o dos Cravos" }, { id: '11mar', label: "11 de Mar√ßo 1975", match: "Golpe Falhado de Sp√≠nola" }, { id: '25nov', label: "25 de Novembro 1975", match: "Fim do PREC" }, { id: '2abr', label: "2 de Abril 1976", match: "Aprova√ß√£o da Constitui√ß√£o" }] },
            { id: 'acronimos', title: "Siglas da Revolu√ß√£o", items: [{ id: 'mfa', label: "MFA", match: "Movimento das For√ßas Armadas" }, { id: 'copcon', label: "COPCON", match: "Comando Operacional do Continente" }, { id: 'prec', label: "PREC", match: "Processo Revolucion√°rio em Curso" }, { id: 'ad', label: "Grupo dos Nove", match: "Documento dos Nove" }] },
            { id: 'locais', title: "Geografia da Crise", items: [{ id: 'tancos', label: "Tancos", match: "Paraquedistas" }, { id: 'monsanto', label: "Monsanto", match: "Comando da For√ßa A√©rea" }, { id: 'amadora', label: "Amadora", match: "Posto Comando Eanes" }, { id: 'belem', label: "Pal√°cio de Bel√©m", match: "Presidente da Rep√∫blica" }] }
        ];

        const QUIZ_QUESTIONS = [
          { question: "Qual foi o evento imediato na madrugada de 25 de novembro de 1975 que serviu de catalisador para a insurrei√ß√£o dos paraquedistas?", options: ["A nomea√ß√£o de Vasco Louren√ßo para o comando da Regi√£o Militar de Lisboa, em substitui√ß√£o de Otelo Saraiva de Carvalho.", "A convoca√ß√£o de uma manifesta√ß√£o da Intersindical contra a NATO.", "A demiss√£o do VI Governo Provis√≥rio liderado por Pinheiro de Azevedo.", "A publica√ß√£o do \"Documento dos Nove\" pelos militares moderados."], correct: 0, instruction: "Pense numa mudan√ßa de poder numa estrutura militar chave de Lisboa que desagradou profundamente a ala radical.", expl: "Esta decis√£o do Conselho da Revolu√ß√£o foi vista pela ala radical como uma provoca√ß√£o e levou √† ocupa√ß√£o de bases a√©reas pelos paraquedistas, que n√£o aceitavam a substitui√ß√£o de Otelo." },
          { question: "Qual foi a a√ß√£o decisiva do Presidente da Rep√∫blica, General Costa Gomes, na tarde de 25 de novembro, que conferiu cobertura legal √† interven√ß√£o militar dos moderados liderados por Ramalho Eanes?", options: ["A decreta√ß√£o do estado de s√≠tio na Regi√£o Militar de Lisboa.", "A dissolu√ß√£o do COPCON.", "A negocia√ß√£o de um acordo direto com Otelo Saraiva de Carvalho em Bel√©m.", "O apelo √† interven√ß√£o de for√ßas militares da NATO."], correct: 0, instruction: "Considere o instrumento legal que um chefe de Estado pode usar para suspender certas garantias e autorizar uma resposta militar a uma insurrei√ß√£o.", expl: "Esta medida, tomada √†s 16h30, transformou a a√ß√£o dos sublevados num ato de ilegalidade contra o Estado e validou o plano operacional dos moderados como uma a√ß√£o de reposi√ß√£o da ordem." },
          { question: "Segundo a perspetiva do Partido Comunista Portugu√™s (PCP), expressa nos textos, como √© caracterizado o 25 de Novembro?", options: ["Uma subleva√ß√£o espont√¢nea de unidades militares esquerdistas sem um plano definido.", "Uma luta interna entre marxistas que resultou na vit√≥ria da ala mais moderada.", "Uma tentativa de golpe de Estado liderada por Otelo Saraiva de Carvalho e pela extrema-esquerda.", "Um golpe militar contra-revolucion√°rio, preparado com anteced√™ncia pelos moderados e pela direita."], correct: 3, instruction: "Pense em como o PCP via a a√ß√£o do grupo de Ramalho Eanes e do \"Grupo dos Nove\".", expl: "O PCP argumenta que existia um plano operacional elaborado h√° meses pelo grupo de Eanes e pelo \"Grupo dos Nove\" para eliminar a influ√™ncia da esquerda nas For√ßas Armadas." },
          { question: "Que unidade militar, sob o comando de Jaime Neves, foi crucial para a vit√≥ria dos moderados, liderando a ofensiva para retomar pontos estrat√©gicos em Lisboa, como o quartel-general da For√ßa A√©rea em Monsanto?", options: ["A Escola Pr√°tica de Cavalaria de Santar√©m.", "O Regimento de Artilharia de Lisboa (RALIS).", "Os Fuzileiros do Alfeite.", "O Regimento de Comandos da Amadora."], correct: 3, instruction: "Esta for√ßa especial era conhecida pela sua disciplina e efic√°cia e operava a partir de uma localidade perto de Lisboa.", expl: "Esta unidade profissional e disciplinada foi a principal for√ßa de assalto dos moderados, executando as opera√ß√µes decisivas sob a coordena√ß√£o de Eanes." },
          { question: "Qual foi uma das consequ√™ncias diretas do 25 de Novembro para a extrema-direita e para figuras como o Marechal Sp√≠nola, segundo a an√°lise de Vitor Teixeira?", options: ["Assumiram o controlo de v√°rias unidades militares no Norte do pa√≠s.", "Sp√≠nola regressou do ex√≠lio para assumir a Presid√™ncia da Rep√∫blica.", "Foram marginalizados e viram o seu projeto de restaura√ß√£o autorit√°ria inviabilizado.", "Formaram uma alian√ßa formal com o \"Grupo dos Nove\" para governar."], correct: 2, instruction: "O resultado do 25 de Novembro consolidou um caminho democr√°tico que se opunha a ambos os extremos do espectro pol√≠tico.", expl: "A vit√≥ria dos moderados consolidou a via democr√°tica pluralista, bloqueando tanto a revolu√ß√£o socialista como as ambi√ß√µes restauracionistas da direita." },
          { question: "Que termo √© usado para descrever o per√≠odo de intensa polariza√ß√£o, conflito social e instabilidade pol√≠tica em Portugal, que se estende aproximadamente de mar√ßo a novembro de 1975?", options: ["A Revolu√ß√£o Cultural.", "O Ver√£o Quente.", "O Estado Novo.", "A Uni√£o Nacional."], correct: 1, instruction: "Pense numa express√£o que evoca um clima de alta temperatura social e pol√≠tica durante uma esta√ß√£o espec√≠fica.", expl: "Este termo, por vezes usado com uma carga depreciativa, descreve o per√≠odo de maior radicaliza√ß√£o e confronto da democratiza√ß√£o portuguesa." },
          { question: "De acordo com os textos, a posi√ß√£o de Otelo Saraiva de Carvalho durante a crise foi crucial. Que fator sobre a sua atua√ß√£o no dia 25 de novembro foi fatal para a subleva√ß√£o da esquerda radical?", options: ["Liderou pessoalmente o ataque dos paraquedistas √† Base A√©rea de Monsanto.", "Declarou publicamente o seu apoio ao \"Grupo dos Nove\" na manh√£ do dia 25.", "A sua aus√™ncia e incapacidade de colocar o COPCON ao servi√ßo dos sublevados, deixando-os sem um comando unificado.", "Negociou a rendi√ß√£o imediata de todas as unidades do COPCON com Ramalho Eanes."], correct: 2, instruction: "A efic√°cia de uma a√ß√£o militar depende frequentemente de uma lideran√ßa clara e presente. Considere o que aconteceu com a lideran√ßa da ala radical nesse dia.", expl: "Otelo ficou incomunic√°vel durante horas cruciais e n√£o conseguiu (ou n√£o quis) unificar as for√ßas radicais sob o seu comando, o que as condenou ao fracasso." },
          { question: "Qual foi a estrat√©gia do Partido Comunista Portugu√™s (PCP) durante o confronto militar de 25 de novembro?", options: ["Mobilizar as suas mil√≠cias armadas para tomar o poder em Lisboa.", "Organizar a resist√™ncia civil no Norte do pa√≠s, em alian√ßa com Pires Veloso.", "Optar pela n√£o-interven√ß√£o militar e desmobilizar as bases para evitar uma guerra civil e garantir a sua sobreviv√™ncia pol√≠tica.", "Adotar uma posi√ß√£o de neutralidade, aguardando o desfecho para se aliar ao vencedor."], correct: 2, instruction: "Pense se o PCP optou por um confronto militar de alto risco ou por uma t√°tica de preserva√ß√£o a longo prazo.", expl: "O contacto de Costa Gomes com Cunhal e as ordens internas do partido para n√£o se envolverem foram cruciais para isolar a subleva√ß√£o militar e evitar uma escalada do conflito." },
          { question: "Que figura internacional, Secret√°rio de Estado dos EUA, expressou a inten√ß√£o de invadir Portugal para evitar o surgimento de uma \"nova Cuba\" na Europa?", options: ["Henry Kissinger", "Leonid Brejnev", "Val√©ry Giscard D'Estaing", "James Callaghan"], correct: 0, instruction: "Esta figura da diplomacia americana era conhecida pela sua pol√≠tica de \"realpolitik\" e pela sua forte oposi√ß√£o ao comunismo durante a Guerra Fria.", expl: "Kissinger via a Revolu√ß√£o Portuguesa com grande alarme, temendo uma expans√£o do comunismo, e chegou a comunicar aos aliados europeus a inten√ß√£o de uma interven√ß√£o militar." },
          { question: "Os objetivos fundamentais do Movimento das For√ßas Armadas (MFA) resumiam-se nos chamados \"tr√™s D\". Quais eram eles?", options: ["Defesa, Doutrina e Disciplina.", "Derrubar, Destituir e Dominar.", "Direitos, Deveres e Decis√£o.", "Descolonizar, Desenvolver e Democratizar."], correct: 3, instruction: "Pense nos tr√™s grandes problemas que Portugal enfrentava em 1974: uma guerra no Ultramar, uma economia atrasada e um regime pol√≠tico n√£o representativo.", expl: "Este lema resumia o programa pol√≠tico do MFA: acabar com a guerra colonial, modernizar a economia e instaurar um regime democr√°tico." },
          { question: "Qual foi a consequ√™ncia pol√≠tica mais significativa da vit√≥ria dos moderados a 25 de Novembro, que definiu o futuro do regime em Portugal?", options: ["A instaura√ß√£o de uma ditadura militar liderada por Ramalho Eanes.", "A entrada imediata de Portugal na Comunidade Econ√≥mica Europeia (CEE).", "O fim do Processo Revolucion√°rio em Curso (PREC) e a cria√ß√£o de condi√ß√µes para a aprova√ß√£o da Constitui√ß√£o de 1976.", "O regresso ao poder de figuras do antigo regime do Estado Novo."], correct: 2, instruction: "A data √© vista como o ponto de viragem que p√¥s fim √† fase revolucion√°ria e abriu caminho para a normaliza√ß√£o institucional do pa√≠s.", expl: "A vit√≥ria dos moderados encerrou o per√≠odo de instabilidade radical, permitindo a conclus√£o dos trabalhos da Assembleia Constituinte e a funda√ß√£o da democracia representativa." },
          { question: "Al√©m da subleva√ß√£o da esquerda radical, que outro tipo de amea√ßa √† democracia portuguesa foi neutralizado com o desfecho do 25 de Novembro?", options: ["Uma interven√ß√£o militar espanhola para restaurar a monarquia.", "As ambi√ß√µes restauracionistas de movimentos clandestinos de extrema-direita como o MDLP e o ELP.", "O separatismo das regi√µes aut√≥nomas dos A√ßores e da Madeira.", "A influ√™ncia da Igreja Cat√≥lica para a cria√ß√£o de um Estado teocr√°tico."], correct: 1, instruction: "O resultado final do 25 de Novembro foi a vit√≥ria de um centro pol√≠tico que se opunha a ambos os extremos.", expl: "A consolida√ß√£o da democracia pluralista pelos moderados marginalizou n√£o s√≥ a esquerda radical, mas tamb√©m os grupos de direita que pretendiam um regresso a um regime autorit√°rio." }
        ];

        // --- COMPONENTES UI ---

        const Button = ({ onClick, children, className = "", variant = "primary", disabled = false }) => {
            const baseStyle = "font-bold font-slab py-3 px-6 rounded-lg transition-all transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none shadow-lg flex items-center justify-center";
            const variants = {
                primary: "bg-rev-red text-white hover:bg-red-800",
                secondary: "bg-rev-gold text-rev-dark hover:bg-yellow-600",
                neutral: "bg-rev-stone text-rev-dark hover:bg-white",
                outline: "border-2 border-rev-stone text-rev-stone hover:bg-rev-stone hover:text-rev-dark"
            };
            return (
                <button onClick={onClick} disabled={disabled} className={`${baseStyle} ${variants[variant]} ${className}`}>
                    {children}
                </button>
            );
        };

        const Card = ({ children, className = "" }) => (
            <div className={`bg-light-navy bg-opacity-50 backdrop-blur-sm border border-rev-stone/20 p-6 sm:p-8 rounded-xl shadow-xl animate-fade-in ${className}`}>
                {children}
            </div>
        );

        const ImageModal = ({ src, alt, onClose }) => {
            if (!src) return null;
            return (
                <div 
                    className="fixed inset-0 bg-black/90 flex items-center justify-center z-[60] animate-fade-in p-4 cursor-zoom-out"
                    onClick={onClose}
                >
                    <div className="relative max-w-7xl w-full max-h-screen flex flex-col items-center">
                        <button 
                            onClick={onClose} 
                            className="absolute -top-12 right-0 text-white hover:text-rev-red transition-colors"
                        >
                            <X size={32} />
                        </button>
                        <img 
                            src={src} 
                            alt={alt} 
                            className="max-w-full max-h-[90vh] object-contain rounded-lg shadow-2xl border border-white/20" 
                            onClick={e => e.stopPropagation()} 
                        />
                        <p className="text-white/60 mt-4 text-sm font-mono">{alt}</p>
                    </div>
                </div>
            );
        };

        const SlideCarousel = ({ slides, onZoom }) => {
            const [current, setCurrent] = useState(0);

            const next = (e) => { e.stopPropagation(); setCurrent((prev) => (prev + 1) % slides.length); };
            const prev = (e) => { e.stopPropagation(); setCurrent((prev) => (prev - 1 + slides.length) % slides.length); };

            return (
                <div className="relative w-full aspect-video bg-black/40 rounded-lg overflow-hidden border border-white/10 group">
                    <div className="absolute inset-0 flex items-center justify-center cursor-zoom-in" onClick={() => onZoom(slides[current], `Slide ${current + 1}`)}>
                         <img 
                            src={slides[current]} 
                            alt={`Slide ${current + 1}`} 
                            className="h-full object-contain"
                        />
                        <div className="absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors flex items-center justify-center pointer-events-none">
                            <Maximize2 className="text-white opacity-0 group-hover:opacity-100 transition-opacity drop-shadow-lg" size={48} />
                        </div>
                    </div>
                   
                    <button onClick={prev} className="absolute left-2 top-1/2 -translate-y-1/2 bg-black/50 text-white p-2 rounded-full hover:bg-rev-red transition-colors">
                        <ChevronLeft size={24} />
                    </button>
                    <button onClick={next} className="absolute right-2 top-1/2 -translate-y-1/2 bg-black/50 text-white p-2 rounded-full hover:bg-rev-red transition-colors">
                        <ChevronRight size={24} />
                    </button>

                    <div className="absolute bottom-4 left-1/2 -translate-x-1/2 bg-black/70 px-4 py-1 rounded-full text-sm font-mono text-white">
                        {current + 1} / {slides.length}
                    </div>
                </div>
            );
        };

        // --- FASES DA APLICA√á√ÉO ---

        const Intro = ({ onStart }) => (
            <div className="flex flex-col items-center text-center animate-fade-in space-y-8 py-10 min-h-[80vh] justify-center">
                <div className="bg-rev-red text-white w-24 h-24 rounded-full flex items-center justify-center shadow-2xl mb-4">
                    <span className="text-5xl">üõë</span>
                </div>
                <h1 className="text-5xl sm:text-7xl font-black font-serif text-white tracking-tight leading-tight">
                    25 de Novembro<br/>de 1975
                </h1>
                <p className="text-xl sm:text-2xl text-rev-stone font-slab max-w-2xl mx-auto border-t border-b border-rev-stone/20 py-6">
                    "O dia que definiu a Democracia Portuguesa"
                </p>
                <p className="text-lg text-gray-400 max-w-xl mx-auto">
                    Uma sequ√™ncia did√°tica interativa sobre o fim do PREC, as fa√ß√µes em confronto e a consolida√ß√£o do regime democr√°tico.
                </p>
                <div className="pt-8">
                    <Button onClick={onStart} variant="secondary">Iniciar Sequ√™ncia Did√°tica</Button>
                </div>
            </div>
        );

        const LearningFlow = ({ onComplete, onImageClick }) => {
            const [index, setIndex] = useState(0);
            const content = LEARNING_CONTENT[index];
            const isLast = index === LEARNING_CONTENT.length - 1;

            const next = () => { if (isLast) onComplete(); else setIndex(index + 1); };
            const prev = () => { if (index > 0) setIndex(index - 1); };

            return (
                <Card className="bg-neutral-900 h-full flex flex-col">
                    <div className="flex-1">
                        <div className="flex flex-col items-center text-center mb-8">
                            <div className="p-4 bg-rev-stone/10 rounded-full mb-6">
                                {content.icon}
                            </div>
                            <h2 className="text-3xl font-bold font-serif text-rev-gold mb-2">{content.title}</h2>
                            <div className="h-1 w-20 bg-rev-red rounded-full"></div>
                        </div>
                        
                        <div className="space-y-6 text-lg text-rev-stone leading-relaxed text-justify sm:text-left mb-8">
                            {content.paragraphs.map((p, i) => (
                                <p key={i} className="bg-white/5 p-4 rounded-lg border-l-4 border-rev-stone hover:border-rev-red transition-colors">
                                    {p}
                                </p>
                            ))}
                        </div>

                        <div className="space-y-8">
                            {content.slides && (
                                <SlideCarousel slides={content.slides} onZoom={onImageClick} />
                            )}

                            {content.image && (
                                <div className="relative group cursor-zoom-in" onClick={() => onImageClick(content.image, content.imageAlt)}>
                                    <div className="absolute inset-0 bg-black/0 group-hover:bg-black/40 transition-colors rounded-lg flex items-center justify-center">
                                        <Maximize2 className="text-white opacity-0 group-hover:opacity-100 transform scale-75 group-hover:scale-100 transition-all" size={48} />
                                    </div>
                                    <img src={content.image} alt={content.imageAlt} className="w-full h-64 md:h-96 object-cover rounded-lg border-2 border-rev-stone/20" />
                                    <p className="text-xs text-center text-gray-500 mt-2 font-mono flex items-center justify-center gap-2">
                                        <Maximize2 size={12}/> Clique para ampliar a infografia
                                    </p>
                                </div>
                            )}

                            {content.video && (
                                <div className="bg-black/30 p-4 rounded-lg border border-white/10">
                                    <div className="flex items-center gap-2 text-rev-gold mb-2 font-bold uppercase tracking-wider text-sm">
                                        <Video size={16}/> Document√°rio
                                    </div>
                                    <video controls className="w-full rounded bg-black aspect-video">
                                        <source src={content.video} type="video/mp4" />
                                        O seu navegador n√£o suporta a reprodu√ß√£o de v√≠deo.
                                    </video>
                                </div>
                            )}

                            {content.audio && (
                                <div className="bg-black/30 p-4 rounded-lg border border-white/10">
                                    <div className="flex items-center gap-2 text-rev-gold mb-2 font-bold uppercase tracking-wider text-sm">
                                        <Headphones size={16}/> Podcast Explicativo
                                    </div>
                                    <audio controls className="w-full h-10 mt-1">
                                        <source src={content.audio} type="audio/mpeg" />
                                        O seu navegador n√£o suporta a reprodu√ß√£o de √°udio.
                                    </audio>
                                </div>
                            )}
                        </div>
                    </div>

                    <div className="flex justify-between items-center mt-10 pt-6 border-t border-white/10">
                        <Button onClick={prev} variant="neutral" disabled={index === 0}>Anterior</Button>
                        <span className="text-sm text-gray-500 font-mono">M√≥dulo {index + 1} / {LEARNING_CONTENT.length}</span>
                        <Button onClick={next} variant="primary">{isLast ? 'Seguinte: Cronologia' : 'Pr√≥ximo'}</Button>
                    </div>
                </Card>
            );
        };

        const Timeline = ({ onComplete }) => (
            <div className="animate-fade-in">
                <h2 className="text-4xl font-bold font-serif text-center text-rev-gold mb-12">Cronologia da Crise</h2>
                
                <div className="relative border-l-4 border-rev-red/30 ml-4 md:ml-10 space-y-8 pb-12 max-w-4xl mx-auto">
                    {TIMELINE_EVENTS.map((evt, i) => (
                        <div key={i} className="relative pl-8 md:pl-12 group">
                            <div className="absolute -left-[14px] top-0 w-6 h-6 rounded-full bg-rev-red border-4 border-rev-dark shadow-[0_0_10px_rgba(185,28,28,0.5)]"></div>
                            
                            <div className="flex flex-col md:flex-row gap-4 items-start bg-neutral-800/50 p-6 rounded-xl hover:bg-neutral-800 transition-colors border border-white/5">
                                <div className="md:w-32 flex-shrink-0 pt-1">
                                    <span className="font-bold font-mono text-rev-red bg-rev-red/10 px-2 py-1 rounded text-sm">
                                        {evt.period}
                                    </span>
                                </div>
                                <div>
                                    <h3 className="text-xl font-bold text-white mb-2">{evt.title}</h3>
                                    <p className="text-gray-300">{evt.desc}</p>
                                </div>
                            </div>
                        </div>
                    ))}
                </div>

                <div className="text-center mt-8 pb-12">
                    <Button onClick={onComplete} variant="secondary">Seguinte: Flashcards <ChevronRight className="ml-2" /></Button>
                </div>
            </div>
        );

        // --- COMPONENTE FLASHCARDS ---
        const Flashcards = ({ onComplete }) => {
            const [current, setCurrent] = useState(0);
            const [isFlipped, setIsFlipped] = useState(false);

            const next = () => {
                setIsFlipped(false);
                setTimeout(() => {
                    if (current < FLASHCARD_DATA.length - 1) {
                        setCurrent(c => c + 1);
                    } else {
                        onComplete();
                    }
                }, 200);
            };

            const prev = () => {
                if (current > 0) {
                    setIsFlipped(false);
                    setTimeout(() => setCurrent(c => c - 1), 200);
                }
            };

            const flip = () => setIsFlipped(!isFlipped);

            return (
                <div className="max-w-2xl mx-auto animate-fade-in text-center h-full flex flex-col justify-center">
                    <h2 className="text-3xl font-bold font-serif text-rev-gold mb-2">Flashcards de Revis√£o</h2>
                    <p className="text-gray-400 mb-8">Clique no cart√£o para ver a resposta.</p>

                    <div className="relative w-full aspect-[4/3] sm:aspect-[16/9] perspective-1000 mb-8 group cursor-pointer" onClick={flip}>
                        <div className={`relative w-full h-full duration-500 transform-style-3d transition-all ${isFlipped ? 'rotate-y-180' : ''}`}>
                            
                            {/* Frente */}
                            <div className="absolute inset-0 w-full h-full bg-neutral-800 border-2 border-rev-stone/20 rounded-2xl p-8 flex flex-col items-center justify-center backface-hidden shadow-xl hover:border-rev-gold transition-colors">
                                <div className="text-rev-gold font-bold uppercase tracking-widest text-sm mb-4">Quest√£o {current + 1}</div>
                                <h3 className="text-xl sm:text-2xl font-bold text-white leading-relaxed">{FLASHCARD_DATA[current].q}</h3>
                                <div className="mt-8 text-xs text-gray-500 flex items-center gap-2">
                                    <RotateCcw size={14} /> Clique para virar
                                </div>
                            </div>

                            {/* Verso */}
                            <div className="absolute inset-0 w-full h-full bg-rev-red border-2 border-red-500 rounded-2xl p-8 flex flex-col items-center justify-center backface-hidden rotate-y-180 shadow-xl">
                                <div className="text-white/80 font-bold uppercase tracking-widest text-sm mb-4">Resposta</div>
                                <p className="text-xl sm:text-2xl font-medium text-white leading-relaxed">{FLASHCARD_DATA[current].a}</p>
                            </div>
                        </div>
                    </div>

                    <div className="flex justify-between items-center pb-8">
                        <Button onClick={prev} variant="neutral" disabled={current === 0}>
                            <ChevronLeft className="mr-2" size={20}/> Anterior
                        </Button>
                        <span className="font-mono text-gray-500">{current + 1} / {FLASHCARD_DATA.length}</span>
                        <Button onClick={next} variant="secondary">
                            {current === FLASHCARD_DATA.length - 1 ? "Seguinte: Atividades" : "Pr√≥ximo"} <ChevronRight className="ml-2" size={20}/>
                        </Button>
                    </div>
                </div>
            );
        };

        // --- COMPONENTE DE CORRESPOND√äNCIA ---
        const MatchingChallenge = ({ challenge, onComplete, isCompleted }) => {
            const [selectedItem, setSelectedItem] = useState(null);
            const [correctMatches, setCorrectMatches] = useState({});
            const [shuffledItems, setShuffledItems] = useState([]);
            const [shuffledMatches, setShuffledMatches] = useState([]);

            useEffect(() => {
                setShuffledItems([...challenge.items].sort(() => Math.random() - 0.5));
                setShuffledMatches([...challenge.items].sort(() => Math.random() - 0.5));
            }, [challenge]);

            const handleSelect = (id, type, label) => {
                if (correctMatches[type === 'item' ? id : Object.keys(correctMatches).find(k => challenge.items.find(i => i.match === label).id === k)]) return;

                if (!selectedItem) {
                    setSelectedItem({ id, type, label });
                } else {
                    if (selectedItem.type === type) {
                        setSelectedItem({ id, type, label });
                    } else {
                        let itemPart = type === 'item' ? { id, label } : selectedItem;
                        let matchPart = type === 'match' ? { id, label } : selectedItem;
                        const originalPair = challenge.items.find(i => i.id === itemPart.id);
                        
                        if (originalPair && originalPair.match === matchPart.label) {
                            const newCorrect = { ...correctMatches, [itemPart.id]: true };
                            setCorrectMatches(newCorrect);
                            setSelectedItem(null);
                            if (Object.keys(newCorrect).length === challenge.items.length && !isCompleted) {
                                onComplete();
                            }
                        } else {
                            setSelectedItem(null);
                        }
                    }
                }
            };

            return (
                <div className="bg-neutral-900 p-6 rounded-xl border border-white/10 mb-8">
                    <div className="flex justify-between items-center mb-4 border-b border-white/10 pb-2">
                        <h3 className="text-xl font-serif text-rev-gold flex items-center gap-2">
                            <LinkIcon size={20}/> {challenge.title}
                        </h3>
                        {isCompleted && <span className="text-green-500 font-bold text-sm flex items-center gap-1"><CheckCircle size={16}/> Completo</span>}
                    </div>
                    
                    <div className="grid grid-cols-2 gap-8">
                        <div className="space-y-3">
                            {shuffledItems.map(item => {
                                const isSolved = correctMatches[item.id];
                                const isSelected = selectedItem?.id === item.id && selectedItem?.type === 'item';
                                return (
                                    <button 
                                        key={item.id}
                                        onClick={() => handleSelect(item.id, 'item', item.label)}
                                        disabled={isSolved}
                                        className={`w-full p-4 rounded text-left text-sm transition-all border-2 ${
                                            isSolved ? 'bg-green-900/30 border-green-600 text-green-400 opacity-50' :
                                            isSelected ? 'bg-rev-red border-rev-red text-white' :
                                            'bg-neutral-800 border-neutral-700 text-gray-300 hover:border-gray-500'
                                        }`}
                                    >
                                        {item.label}
                                    </button>
                                )
                            })}
                        </div>
                        <div className="space-y-3">
                            {shuffledMatches.map((item, idx) => {
                                const sourceItem = challenge.items.find(i => i.match === item.match);
                                const isSolved = correctMatches[sourceItem.id];
                                const isSelected = selectedItem?.label === item.match && selectedItem?.type === 'match';
                                return (
                                    <button 
                                        key={idx}
                                        onClick={() => handleSelect(idx, 'match', item.match)}
                                        disabled={isSolved}
                                        className={`w-full p-4 rounded text-right text-sm transition-all border-2 ${
                                            isSolved ? 'bg-green-900/30 border-green-600 text-green-400 opacity-50' :
                                            isSelected ? 'bg-rev-gold border-rev-gold text-rev-dark font-bold' :
                                            'bg-neutral-800 border-neutral-700 text-gray-300 hover:border-gray-500'
                                        }`}
                                    >
                                        {item.match}
                                    </button>
                                )
                            })}
                        </div>
                    </div>
                </div>
            );
        };

        // --- ATIVIDADES FORMATIVAS ---
        const FormativeActivities = ({ onComplete }) => {
            const [completedChallenges, setCompletedChallenges] = useState([]);
            const [tfAnswers, setTfAnswers] = useState({});

            const handleChallengeComplete = (id) => {
                if (!completedChallenges.includes(id)) {
                    setCompletedChallenges(prev => [...prev, id]);
                }
            };

            const tfQuestions = [
                { t: "O 25 de Novembro levou a uma Guerra Civil sangrenta.", a: false },
                { t: "Os Comandos da Amadora apoiaram os Moderados.", a: true },
                { t: "O Presidente Costa Gomes fugiu do pa√≠s.", a: false },
                { t: "O COPCON foi extinto ap√≥s a crise.", a: true }
            ];

            const handleTfAnswer = (idx, val) => setTfAnswers(prev => ({...prev, [idx]: val}));

            const finish = () => {
                let score = 0;
                score += completedChallenges.length * 4;
                tfQuestions.forEach((q, i) => {
                    if (tfAnswers[i] === q.a) score += 1;
                });
                onComplete(score);
            };

            const allTfAnswered = Object.keys(tfAnswers).length === tfQuestions.length;
            const allChallengesDone = completedChallenges.length === MATCHING_CHALLENGES.length;

            return (
                <div className="max-w-4xl mx-auto animate-fade-in pb-12">
                    <h2 className="text-3xl font-bold font-serif text-center text-rev-gold mb-2">Atividades Pr√°ticas</h2>
                    <p className="text-center text-gray-400 mb-8">Complete os desafios de correspond√™ncia e o V/F para desbloquear o Debate e o Quiz Final.</p>
                    
                    {MATCHING_CHALLENGES.map(challenge => (
                        <MatchingChallenge 
                            key={challenge.id} 
                            challenge={challenge} 
                            onComplete={() => handleChallengeComplete(challenge.id)}
                            isCompleted={completedChallenges.includes(challenge.id)}
                        />
                    ))}

                    <div className="bg-neutral-900 p-6 rounded-xl border border-white/10 mt-8">
                        <h3 className="text-xl font-serif text-rev-gold mb-4 flex items-center gap-2">
                            <CheckCircle size={20}/> Verdadeiro ou Falso
                        </h3>
                        <div className="space-y-3">
                            {tfQuestions.map((q, i) => {
                                const isAnswered = tfAnswers[i] !== undefined;
                                return (
                                    <div key={i} className="flex flex-col sm:flex-row justify-between items-center bg-black/20 p-4 rounded gap-4">
                                        <p className="flex-1 font-medium text-gray-300">{q.t}</p>
                                        <div className="flex gap-2">
                                            <button 
                                                onClick={() => handleTfAnswer(i, true)} 
                                                className={`px-4 py-1 rounded font-bold transition-colors ${
                                                    isAnswered && tfAnswers[i] === true ? "bg-blue-600 text-white" : "bg-neutral-700 text-gray-400 hover:bg-neutral-600"
                                                }`}
                                            >V</button>
                                            <button 
                                                onClick={() => handleTfAnswer(i, false)} 
                                                className={`px-4 py-1 rounded font-bold transition-colors ${
                                                    isAnswered && tfAnswers[i] === false ? "bg-blue-600 text-white" : "bg-neutral-700 text-gray-400 hover:bg-neutral-600"
                                                }`}
                                            >F</button>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>

                    <div className="text-center mt-12">
                        <Button onClick={finish} variant="primary" disabled={!allChallengesDone || !allTfAnswered}>
                            Seguinte: Debate <ChevronRight className="ml-2" />
                        </Button>
                    </div>
                </div>
            );
        };

        // --- NOVO M√ìDULO DE DEBATE ---
        const DebateActivity = ({ onComplete }) => {
            const [selectedPerspective, setSelectedPerspective] = useState(null); 
            const [reflection, setReflection] = useState("");
            const [submitted, setSubmitted] = useState(false);

            const handleSubmit = () => {
                if(reflection.trim().length > 10) {
                    setSubmitted(true);
                    onComplete(reflection, selectedPerspective);
                }
            };

            return (
                <div className="max-w-4xl mx-auto animate-fade-in pb-12">
                    <div className="text-center mb-12">
                        <h2 className="text-3xl font-bold font-serif text-rev-gold mb-2">O Grande Debate Hist√≥rico</h2>
                        <p className="text-gray-400">Analise as perspetivas, escolha a sua "Lente Hist√≥rica" e defenda a sua vis√£o.</p>
                    </div>

                    <div className="grid md:grid-cols-2 gap-8 mb-12">
                        {/* Tese A */}
                        <div 
                            onClick={() => !submitted && setSelectedPerspective('counter')}
                            className={`cursor-pointer p-6 rounded-xl border-2 transition-all ${
                                selectedPerspective === 'counter' ? 'bg-blue-900/30 border-blue-500' : 'bg-neutral-900 border-white/10 hover:border-blue-500/50'
                            }`}
                        >
                            <h3 className="text-xl font-bold text-blue-400 mb-4 flex items-center gap-2">
                                <Shield size={20}/> O Contragolpe Necess√°rio
                            </h3>
                            <ul className="text-sm text-gray-300 space-y-2 list-disc list-inside">
                                <li>A√ß√£o defensiva para salvar a democracia pluralista.</li>
                                <li>Legitimada pelo Presidente da Rep√∫blica.</li>
                                <li>Restaurou a ordem e a hierarquia militar.</li>
                                <li>Evitou uma ditadura comunista ("Nova Cuba").</li>
                            </ul>
                        </div>

                        {/* Tese B */}
                        <div 
                            onClick={() => !submitted && setSelectedPerspective('coup')}
                            className={`cursor-pointer p-6 rounded-xl border-2 transition-all ${
                                selectedPerspective === 'coup' ? 'bg-red-900/30 border-red-500' : 'bg-neutral-900 border-white/10 hover:border-red-500/50'
                            }`}
                        >
                            <h3 className="text-xl font-bold text-red-400 mb-4 flex items-center gap-2">
                                <AlertCircle size={20}/> O Golpe Contrarrevolucion√°rio
                            </h3>
                            <ul className="text-sm text-gray-300 space-y-2 list-disc list-inside">
                                <li>A√ß√£o premeditada para travar o avan√ßo social.</li>
                                <li>Plano elaborado meses antes pelos moderados.</li>
                                <li>Visava a depura√ß√£o da esquerda das For√ßas Armadas.</li>
                                <li>Travou o projeto de "Poder Popular" e democracia direta.</li>
                            </ul>
                        </div>
                    </div>

                    {selectedPerspective && (
                        <div className="bg-neutral-800 p-8 rounded-xl border-t-4 border-rev-gold animate-fade-in">
                            <h3 className="text-lg font-bold text-white mb-4 flex items-center gap-2">
                                <MessageSquare size={20} /> A Sua Reflex√£o
                            </h3>
                            <p className="text-sm text-gray-400 mb-4">
                                Com base na perspetiva que escolheu ({selectedPerspective === 'counter' ? 'Contragolpe' : 'Golpe'}), escreva um breve argumento defendendo:
                                1. A sua vis√£o hist√≥rica; 2. A import√¢ncia do evento para a democracia atual.
                            </p>
                            <textarea 
                                className="w-full bg-neutral-900 text-white p-4 rounded-lg border border-gray-700 focus:border-rev-gold outline-none h-32 mb-4"
                                placeholder="Escreva aqui a sua defesa..."
                                value={reflection}
                                onChange={(e) => setReflection(e.target.value)}
                                disabled={submitted}
                            />
                            
                            {!submitted ? (
                                <Button onClick={handleSubmit} variant="secondary" disabled={reflection.trim().length < 10}>
                                    Submeter e Continuar
                                </Button>
                            ) : (
                                <div className="text-center">
                                    <p className="text-green-400 font-bold mb-4">Reflex√£o registada!</p>
                                </div>
                            )}
                        </div>
                    )}
                </div>
            );
        };

        const Quiz = ({ onComplete }) => {
            const [current, setCurrent] = useState(0);
            const [answers, setAnswers] = useState({}); 
            const [selected, setSelected] = useState(null);
            const [showFeedback, setShowFeedback] = useState(false);

            const handleAnswer = (idx) => {
                if(showFeedback) return;
                setSelected(idx);
                setShowFeedback(true);
                setAnswers(prev => ({ ...prev, [current]: idx }));
            };

            const next = () => {
                if(current < QUIZ_QUESTIONS.length - 1) {
                    setCurrent(c => c + 1);
                    setSelected(null);
                    setShowFeedback(false);
                } else {
                    let finalScore = 0;
                    Object.keys(answers).forEach(qIdx => {
                        if (answers[qIdx] === QUIZ_QUESTIONS[qIdx].correct) {
                            finalScore++;
                        }
                    });
                    onComplete(finalScore, QUIZ_QUESTIONS.length, answers);
                }
            };

            const q = QUIZ_QUESTIONS[current];

            return (
                <Card className="max-w-3xl mx-auto bg-neutral-900 border-t-4 border-t-rev-gold">
                    <div className="flex justify-between text-sm text-gray-500 mb-6 font-mono uppercase tracking-widest">
                        <span>Quiz Final</span>
                        <span>{current + 1} / {QUIZ_QUESTIONS.length}</span>
                    </div>

                    <div className="mb-6 bg-blue-900/20 border-l-4 border-blue-500 p-4 rounded-r-lg">
                        <p className="text-blue-200 text-sm font-medium flex items-start gap-2">
                            <HelpCircle size={18} className="mt-0.5 flex-shrink-0" />
                            <span className="italic">Dica: {q.instruction}</span>
                        </p>
                    </div>

                    <h3 className="text-xl sm:text-2xl font-bold text-white mb-8 min-h-[64px]">{q.question}</h3>

                    <div className="space-y-3 mb-8">
                        {q.options.map((opt, idx) => {
                            let style = "bg-neutral-800 hover:bg-neutral-700 text-left w-full p-4 rounded-lg transition-all border border-transparent";
                            if(showFeedback) {
                                if(idx === q.correct) style = "bg-green-900 border-green-500 text-green-100";
                                else if(idx === selected) style = "bg-red-900 border-red-500 text-red-100";
                                else style = "bg-neutral-800 opacity-50";
                            }
                            return (
                                <button key={idx} onClick={() => handleAnswer(idx)} disabled={showFeedback} className={style}>
                                    <span className="font-bold mr-2 text-rev-gold">{['A','B','C','D'][idx]}.</span> {opt}
                                </button>
                            );
                        })}
                    </div>

                    {showFeedback && (
                        <div className="bg-green-900/20 border border-green-500/30 p-4 rounded-lg mb-6 animate-fade-in">
                             <p className="text-green-200 text-sm"><span className="font-bold">Feedback:</span> {q.expl}</p>
                        </div>
                    )}

                    <div className="text-right">
                        <Button onClick={next} variant="primary" disabled={!showFeedback}>
                            {current === QUIZ_QUESTIONS.length - 1 ? "Ver Resultados" : "Pr√≥xima Pergunta"}
                        </Button>
                    </div>
                </Card>
            );
        };

        const ReviewMode = ({ userAnswers, onBack }) => {
            return (
                <div className="animate-fade-in max-w-4xl mx-auto space-y-6 pb-12">
                     <div className="flex items-center gap-4 mb-8">
                        <button onClick={onBack} className="bg-neutral-800 hover:bg-neutral-700 p-2 rounded-full transition-colors">
                            <ChevronLeft className="text-white" />
                        </button>
                        <h2 className="text-3xl font-bold text-rev-gold font-serif">Revis√£o do Question√°rio</h2>
                    </div>

                    {QUIZ_QUESTIONS.map((q, idx) => {
                        const userAnswer = userAnswers[idx];
                        const isCorrect = userAnswer === q.correct;
                        return (
                            <Card key={idx} className={`bg-neutral-900 border-l-4 ${isCorrect ? 'border-green-500' : 'border-red-500'}`}>
                                <div className="flex gap-4">
                                    <div className="flex-shrink-0 mt-1">
                                        {isCorrect 
                                            ? <CheckCircle className="text-green-500" /> 
                                            : <X className="text-red-500" />
                                        }
                                    </div>
                                    <div className="flex-1">
                                        <p className="text-gray-400 text-xs mb-1">Quest√£o {idx + 1}</p>
                                        <h4 className="text-lg font-bold text-white mb-4">{q.question}</h4>
                                        
                                        <div className="space-y-2 mb-4">
                                            {q.options.map((opt, optIdx) => (
                                                <div key={optIdx} className={`p-3 rounded text-sm ${
                                                    optIdx === q.correct 
                                                        ? "bg-green-900/40 text-green-200 border border-green-700"
                                                        : optIdx === userAnswer 
                                                            ? "bg-red-900/40 text-red-200 border border-red-700"
                                                            : "bg-neutral-800 text-gray-400 opacity-50"
                                                }`}>
                                                    {opt}
                                                </div>
                                            ))}
                                        </div>

                                        <div className="bg-black/30 p-3 rounded text-sm text-gray-300">
                                            <span className="text-rev-gold font-bold">Explica√ß√£o:</span> {q.expl}
                                        </div>
                                    </div>
                                </div>
                            </Card>
                        )
                    })}
                    
                    <div className="text-center pt-8">
                        <Button onClick={onBack} variant="neutral">Voltar ao Certificado</Button>
                    </div>
                </div>
            );
        };

        const Conclusion = ({ quizScore, quizTotal, practiceScore, practiceTotal, userAnswers, debateData, onRestart }) => {
            const [name, setName] = useState("");
            const [generated, setGenerated] = useState(false);
            const [reviewing, setReviewing] = useState(false);
            
            // C√°lculos Finais
            const totalPoints = quizScore + practiceScore;
            const maxPoints = quizTotal + practiceTotal;
            const finalPercentage = Math.round((totalPoints / maxPoints) * 100);

            // Escala Qualitativa
            let qualitativeGrade = "";
            let gradeColor = "";
            if (finalPercentage <= 49) { qualitativeGrade = "Insuficiente"; gradeColor = "text-red-500"; }
            else if (finalPercentage <= 69) { qualitativeGrade = "Suficiente"; gradeColor = "text-yellow-500"; }
            else if (finalPercentage <= 89) { qualitativeGrade = "Bom"; gradeColor = "text-blue-400"; }
            else if (finalPercentage <= 99) { qualitativeGrade = "Muito Bom"; gradeColor = "text-green-400"; }
            else { qualitativeGrade = "Excelente"; gradeColor = "text-rev-gold"; }

            const generate = (e) => { e.preventDefault(); if(name.trim()) setGenerated(true); };

            if (reviewing) {
                return <ReviewMode userAnswers={userAnswers} onBack={() => setReviewing(false)} />;
            }

            if(!generated) {
                return (
                    <Card className="max-w-2xl mx-auto text-center">
                        <Award size={64} className="mx-auto text-rev-gold mb-4" />
                        <h2 className="text-4xl font-black text-white mb-2">Percurso Conclu√≠do!</h2>
                        <p className="text-xl text-gray-300 mb-8">A sua avalia√ß√£o final est√° pronta.</p>
                        
                        <div className="bg-neutral-800 p-6 rounded-xl border border-white/5 mb-8">
                            <p className="text-sm text-gray-400 uppercase tracking-widest mb-2">Classifica√ß√£o Global</p>
                            <p className={`text-5xl font-black ${gradeColor} mb-2`}>{finalPercentage}%</p>
                            <p className={`text-xl font-serif ${gradeColor}`}>{qualitativeGrade}</p>
                        </div>

                        <div className="grid grid-cols-2 gap-4 mb-8 text-sm">
                            <div className="bg-neutral-900 p-3 rounded border border-white/5">
                                <span className="text-gray-500 block">Pr√°tica (Esfor√ßo)</span>
                                <span className="text-white font-bold">{practiceScore} / {practiceTotal}</span>
                            </div>
                            <div className="bg-neutral-900 p-3 rounded border border-white/5">
                                <span className="text-gray-500 block">Quiz (Conhecimento)</span>
                                <span className="text-white font-bold">{quizScore} / {quizTotal}</span>
                            </div>
                        </div>

                        <div className="flex flex-col gap-4">
                            <form onSubmit={generate} className="bg-neutral-800 p-6 rounded-xl border border-white/5">
                                <label className="block text-left text-sm text-gray-400 mb-2">Nome do Aluno (para Certificado):</label>
                                <input 
                                    type="text" 
                                    value={name} 
                                    onChange={e => setName(e.target.value)}
                                    className="w-full bg-black/50 border border-gray-600 rounded p-3 text-white mb-4 focus:border-rev-gold outline-none"
                                    placeholder="Insira o seu nome completo..."
                                    required
                                />
                                <Button type="submit" variant="secondary" className="w-full">Gerar Certificado</Button>
                            </form>
                            
                             <button onClick={onRestart} className="text-gray-500 hover:text-white text-sm mt-4 flex items-center justify-center gap-2">
                                <RotateCcw size={14} /> Reiniciar Tudo
                            </button>
                        </div>
                    </Card>
                );
            }

            return (
                <div className="animate-fade-in">
                    <div id="printable-area">
                        {/* P√°gina 1: Certificado */}
                        <div className="bg-rev-paper text-black p-12 rounded-xl shadow-2xl max-w-4xl mx-auto text-center border-[20px] border-double border-rev-gold relative mb-8 page-break">
                            <div className="absolute inset-0 flex items-center justify-center opacity-5 pointer-events-none">
                                <Shield size={400} />
                            </div>

                            <div className="relative z-10">
                                <div className="flex justify-center mb-6 text-rev-red">
                                    <Award size={80} strokeWidth={1.5} />
                                </div>
                                <h1 className="text-5xl font-serif font-black uppercase tracking-widest text-rev-dark mb-2">Certificado</h1>
                                <h2 className="text-xl font-sans uppercase tracking-widest text-rev-gold mb-12">de Aproveitamento</h2>

                                <p className="text-xl font-serif italic text-gray-600 mb-4">Certifica-se que</p>
                                <div className="text-4xl font-bold text-rev-dark border-b-2 border-rev-dark inline-block px-12 pb-2 mb-8 font-serif">
                                    {name}
                                </div>
                                
                                <p className="text-xl text-gray-700 mb-2">concluiu a sequ√™ncia did√°tica sobre</p>
                                <h3 className="text-3xl font-bold text-rev-red font-slab mb-12">A Crise de 25 de Novembro de 1975</h3>

                                <div className="bg-gray-100 p-6 rounded-lg border border-gray-300 mb-12 max-w-lg mx-auto">
                                    <div className="text-sm text-gray-500 uppercase tracking-wider mb-2">Avalia√ß√£o Final</div>
                                    <div className="text-5xl font-black text-rev-dark mb-2">{finalPercentage}%</div>
                                    <div className="text-2xl font-serif text-rev-gold font-bold">{qualitativeGrade}</div>
                                    <div className="mt-4 pt-4 border-t border-gray-300 flex justify-between text-sm text-gray-600">
                                        <span>Pr√°tica: {practiceScore}/{practiceTotal}</span>
                                        <span>Quiz: {quizScore}/{quizTotal}</span>
                                    </div>
                                </div>

                                <div className="flex justify-between items-end px-12">
                                    <div className="text-left">
                                        <div className="text-xl font-bold text-rev-dark mb-1">{new Date().toLocaleDateString('pt-PT')}</div>
                                        <div className="text-xs text-gray-500 uppercase tracking-wider">Data de Emiss√£o</div>
                                    </div>
                                    <div className="text-center">
                                        <div className="w-16 h-16 bg-rev-gold rounded-full flex items-center justify-center text-white font-bold text-xs mx-auto mb-2 shadow-inner">
                                            SELO<br/>DIGITAL
                                        </div>
                                    </div>
                                    <div className="text-right">
                                        <div className="w-40 border-b border-gray-400 mb-2"></div>
                                        <div className="text-xs text-gray-500">Assinatura do Professor</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* P√°gina 2: Anexo Debate (Se existir) */}
                        {debateData && (
                            <div className="bg-white text-black p-12 rounded-xl shadow-xl max-w-4xl mx-auto border border-gray-200 relative mt-8">
                                <div className="border-b-2 border-rev-gold pb-4 mb-8 flex justify-between items-center">
                                    <h2 className="text-2xl font-bold font-serif text-rev-dark">Anexo: Reflex√£o do Debate</h2>
                                    <span className="text-sm text-gray-500">Portef√≥lio do Aluno</span>
                                </div>
                                
                                <div className="mb-8">
                                    <h3 className="text-sm font-bold text-gray-400 uppercase tracking-wider mb-2">Perspetiva Escolhida</h3>
                                    <div className="inline-block bg-gray-100 px-4 py-2 rounded-lg font-bold text-rev-dark border border-gray-300">
                                        {debateData.perspective === 'counter' ? 'O Contragolpe Necess√°rio' : 'O Golpe Contrarrevolucion√°rio'}
                                    </div>
                                </div>

                                <div>
                                    <h3 className="text-sm font-bold text-gray-400 uppercase tracking-wider mb-4">Argumenta√ß√£o e Defesa</h3>
                                    <div className="bg-gray-50 p-8 rounded-lg border border-gray-200 italic text-lg leading-relaxed text-gray-800 font-serif">
                                        "{debateData.reflection}"
                                    </div>
                                </div>
                                
                                <div className="mt-12 text-center text-xs text-gray-400">
                                    Este documento √© parte integrante da avalia√ß√£o da sequ√™ncia did√°tica.
                                </div>
                            </div>
                        )}
                    </div>

                    <div className="text-center mt-8 space-x-4 no-print flex justify-center pb-12">
                        <Button onClick={() => window.print()} variant="neutral">Imprimir Certificado e Debate</Button>
                        <Button onClick={() => setReviewing(true)} variant="outline">Rever Quiz</Button>
                        <Button onClick={onRestart} variant="secondary">Novo In√≠cio</Button>
                    </div>
                </div>
            );
        };

        // --- COMPONENTE SIDEBAR ---
        const Sidebar = ({ currentPhase, onNavigate, isOpen, onClose }) => {
            const menuItems = [
                { id: APP_SECTIONS.INTRO, label: 'In√≠cio', icon: <GraduationCap size={20} /> },
                { id: APP_SECTIONS.LEARNING, label: 'Estudo & Multim√©dia', icon: <BookOpen size={20} /> },
                { id: APP_SECTIONS.TIMELINE, label: 'Cronologia', icon: <Clock size={20} /> },
                { id: APP_SECTIONS.FLASHCARDS, label: 'Flashcards', icon: <RotateCcw size={20} /> },
                { id: APP_SECTIONS.FORMATIVE, label: 'Atividades Pr√°ticas', icon: <List size={20} /> },
                { id: APP_SECTIONS.DEBATE, label: 'Debate', icon: <MessageSquare size={20} /> },
                { id: APP_SECTIONS.QUIZ, label: 'Quiz Final', icon: <Award size={20} /> },
            ];

            return (
                <>
                    {/* Overlay para mobile */}
                    {isOpen && (
                        <div className="fixed inset-0 bg-black/50 z-40 md:hidden" onClick={onClose}></div>
                    )}

                    {/* Sidebar */}
                    <div className={`fixed top-0 left-0 h-full w-64 bg-neutral-900 border-r border-white/10 z-50 transform transition-transform duration-300 ease-in-out ${isOpen ? 'translate-x-0' : '-translate-x-full'} md:translate-x-0`}>
                        <div className="p-6 border-b border-white/10 flex justify-between items-center">
                            <h1 className="text-xl font-bold text-rev-red font-serif">25 NOV 1975</h1>
                            <button onClick={onClose} className="md:hidden text-gray-400 hover:text-white">
                                <X size={24} />
                            </button>
                        </div>
                        
                        <nav className="p-4 space-y-2 overflow-y-auto h-[calc(100vh-80px)]">
                            {menuItems.map((item) => (
                                <button
                                    key={item.id}
                                    onClick={() => { onNavigate(item.id); onClose(); }}
                                    className={`w-full flex items-center p-3 rounded-lg transition-all text-sm font-medium ${
                                        currentPhase === item.id 
                                            ? 'bg-rev-red text-white shadow-lg' 
                                            : 'text-gray-400 hover:bg-white/5 hover:text-white'
                                    }`}
                                >
                                    <span className="mr-3">{item.icon}</span>
                                    {item.label}
                                </button>
                            ))}
                            
                            {/* LINK EXTERNO ADICIONADO AQUI */}
                            <a
                                href="jogo_25nov.html"
                                target="_blank"
                                rel="noopener noreferrer"
                                className="w-full flex items-center p-3 rounded-lg transition-all text-sm font-medium text-gray-400 hover:bg-white/5 hover:text-white"
                            >
                                <span className="mr-3"><Gamepad2 size={20} /></span>
                                Jogo
                            </a>

                            {/* Indicador de Conclus√£o apenas se ativo */}
                            {currentPhase === APP_SECTIONS.CONCLUSION && (
                                <div className="mt-8 p-4 bg-rev-gold/10 rounded-lg border border-rev-gold/30">
                                    <p className="text-rev-gold text-xs font-bold uppercase tracking-widest mb-1">Estado</p>
                                    <p className="text-white text-sm">Certificado Dispon√≠vel</p>
                                </div>
                            )}
                        </nav>
                    </div>
                </>
            );
        };

        // --- APP PRINCIPAL ---

        function App() {
            const [phase, setPhase] = useState(APP_SECTIONS.INTRO);
            const [isSidebarOpen, setSidebarOpen] = useState(false);
            const [quizResults, setQuizResults] = useState({score:0, total:0, userAnswers:{}});
            const [practiceScore, setPracticeScore] = useState(0);
            const [debateData, setDebateData] = useState(null);
            const [zoomedImage, setZoomedImage] = useState(null);

            // Navega√ß√£o Direta
            const navigateTo = (newPhase) => setPhase(newPhase);

            // Callbacks de Conclus√£o de M√≥dulos (para bot√µes "Seguinte")
            const handleDebateComplete = (reflection, perspective) => {
                setDebateData({ reflection, perspective });
                setPhase(APP_SECTIONS.QUIZ);
            };

            const handlePracticeComplete = (score) => {
                setPracticeScore(score);
                setPhase(APP_SECTIONS.DEBATE);
            };
            
            const finishQuiz = (s, t, answers) => { 
                setQuizResults({score:s, total:t, userAnswers: answers}); 
                setPhase(APP_SECTIONS.CONCLUSION); 
            };
            
            const restart = () => { 
                setQuizResults({score:0, total:0, userAnswers:{}}); 
                setPracticeScore(0);
                setDebateData(null);
                setPhase(APP_SECTIONS.INTRO); 
            };

            // Renderiza√ß√£o Condicional
            const renderPhase = () => {
                switch(phase) {
                    case APP_SECTIONS.INTRO: return <Intro onStart={() => setPhase(APP_SECTIONS.LEARNING)} />;
                    case APP_SECTIONS.LEARNING: return <LearningFlow onComplete={() => setPhase(APP_SECTIONS.TIMELINE)} onImageClick={(src, alt) => setZoomedImage({src, alt})} />;
                    case APP_SECTIONS.TIMELINE: return <Timeline onComplete={() => setPhase(APP_SECTIONS.FLASHCARDS)} />;
                    case APP_SECTIONS.FLASHCARDS: return <Flashcards onComplete={() => setPhase(APP_SECTIONS.FORMATIVE)} />;
                    case APP_SECTIONS.FORMATIVE: return <FormativeActivities onComplete={handlePracticeComplete} />;
                    case APP_SECTIONS.DEBATE: return <DebateActivity onComplete={handleDebateComplete} />;
                    case APP_SECTIONS.QUIZ: return <Quiz onComplete={finishQuiz} />;
                    case APP_SECTIONS.CONCLUSION: return <Conclusion 
                        quizScore={quizResults.score} 
                        quizTotal={quizResults.total} 
                        userAnswers={quizResults.userAnswers}
                        practiceScore={practiceScore}
                        practiceTotal={20} 
                        debateData={debateData}
                        onRestart={restart} 
                    />;
                    default: return <Intro onStart={() => setPhase(APP_SECTIONS.LEARNING)} />;
                }
            };

            return (
                <div className="min-h-screen bg-rev-dark text-rev-stone font-sans flex">
                    {/* Sidebar Navigation */}
                    <Sidebar 
                        currentPhase={phase} 
                        onNavigate={navigateTo} 
                        isOpen={isSidebarOpen} 
                        onClose={() => setSidebarOpen(false)} 
                    />

                    {/* Main Content Wrapper */}
                    <div className="flex-1 flex flex-col md:pl-64 min-h-screen transition-all duration-300">
                        
                        {/* Mobile Header */}
                        <header className="bg-neutral-900 border-b border-white/10 p-4 sticky top-0 z-30 flex justify-between items-center md:hidden">
                            <span className="font-bold text-rev-red tracking-wider">25 NOV 1975</span>
                            <button onClick={() => setSidebarOpen(true)} className="text-white p-2">
                                <Menu />
                            </button>
                        </header>

                        {/* Conte√∫do Principal */}
                        <main className="flex-grow p-4 md:p-8 lg:p-12 flex items-center justify-center overflow-y-auto">
                            <div className="w-full max-w-5xl mx-auto">
                                {renderPhase()}
                            </div>
                        </main>

                        <footer className="p-6 text-center text-xs text-gray-600 no-print border-t border-white/5 bg-neutral-900/50">
                            <p>Teod√≥sio Faria ¬©2025 a crise do 25 de novembro de 1975</p>
                        </footer>
                    </div>

                    {/* Lightbox / Zoom Modal */}
                    {zoomedImage && <ImageModal src={zoomedImage.src} alt={zoomedImage.alt} onClose={() => setZoomedImage(null)} />}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<StrictMode><App /></StrictMode>);
    </script>
</body>
</html>